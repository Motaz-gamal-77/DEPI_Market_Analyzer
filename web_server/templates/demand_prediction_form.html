<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Demand Prediction</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #result {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .dropdown-container {
            position: relative;
            display: inline-block;
        }
        .dropdown {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1;
        }
        .dropdown div {
            padding: 8px;
            cursor: pointer;
        }
        .dropdown div:hover {
            background-color: #f1f1f1;
        }
    </style>
    <a href="/">Home</a>
    <a href="/price_prediction">Price Prediction</a>
    <a href="/demand_prediction">Demand Prediction</a>
    <a href="/sentiment_analysis">Sentiment Analysis</a>
</head>
<body>
    <h1>Product Demand Prediction</h1>

    <!-- Product dropdown -->
    <div class="dropdown-container">
        <input type="text" id="productName" placeholder="Enter product name" oninput="filterProducts()">
        <div id="dropdown" class="dropdown"></div>
    </div>
    <br>

    <!-- Time period input -->
    <label for="timePeriod">Time Period (in days):</label>
    <input type="number" id="timePeriod" placeholder="Enter time period">
    <br><br>

    <!-- Optional date input -->
    <label for="optionalDate">Optional Date (YYYY-MM-DD):</label>
    <input type="date" id="optionalDate">
    <br><br>

    <!-- Buttons for prediction -->
    <button onclick="predictDemandAtDate()">Predict Demand at Specific Date</button>
    <button onclick="predictDemandForPeriod()">Predict Demand for Future Period</button>
    <div id="result"></div>

    <script>
        let products = [];  // This will store your product data
        let selectedProductId = null;  // To store the selected product ID

        // Fetch products from the server
        async function fetchProducts() {
            try {
                const response = await axios.get('/get_products');
                products = response.data;
                displayProducts(products);  // Display initial product list
            } catch (error) {
                console.error("Error fetching products:", error);
            }
        }

        // Display products in dropdown
        function displayProducts(products) {
            const dropdown = document.getElementById('dropdown');
            dropdown.innerHTML = '';  // Clear previous items
            products.forEach(product => {
                const div = document.createElement('div');
                div.innerHTML = product.product_name;
                div.onclick = () => selectProduct(product.product_id, product.product_name);
                dropdown.appendChild(div);
            });
            dropdown.style.display = products.length ? 'block' : 'none'; // Show dropdown if there are products
        }

        // Filter products based on input
        function filterProducts() {
            const input = document.getElementById('productName').value.toLowerCase();
            const filteredProducts = products.filter(product =>
                product.product_name.toLowerCase().includes(input)
            );
            displayProducts(filteredProducts);
        }

        // Select product from dropdown
        function selectProduct(productId, productName) {
            selectedProductId = productId;
            document.getElementById('productName').value = productName;
            document.getElementById('dropdown').style.display = 'none';  // Hide dropdown
        }

        // Function to predict demand at a specific date
        async function predictDemandAtDate() {
            const resultDiv = document.getElementById('result');
            const optionalDate = document.getElementById('optionalDate').value;

            resultDiv.innerHTML = 'Loading...';

            if (!selectedProductId || !optionalDate) {
                resultDiv.innerHTML = `<p class="error">Please select a product and provide a valid date.</p>`;
                return;
            }

            try {
                const response = await axios.post('/demand_prediction', {
                    product_id: selectedProductId,
                    time_period: null,  // Not sending time_period
                    optional_date: optionalDate  // Send only date
                });
                resultDiv.innerHTML = response.data;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        }

        // Function to predict demand for a future period
        async function predictDemandForPeriod() {
            const resultDiv = document.getElementById('result');
            const timePeriod = document.getElementById('timePeriod').value;

            resultDiv.innerHTML = 'Loading...';

            if (!selectedProductId || !timePeriod) {
                resultDiv.innerHTML = `<p class="error">Please select a product and provide a time period.</p>`;
                return;
            }

            try {
                const response = await axios.post('/demand_prediction', {
                    product_id: selectedProductId,
                    time_period: timePeriod,  // Send only time_period
                    optional_date: null  // Not sending date
                });
                resultDiv.innerHTML = response.data;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        }

        // Fetch products when the page loads
        window.onload = fetchProducts;
    </script>
</body>
</html>
